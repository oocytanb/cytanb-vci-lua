-- cytanb | Copyright (c) 2019 oO (https://github.com/oocytanb) | MIT Licensed
---@type cytanb @See `cytanb_annotations.lua`
local cytanb=(function()math.randomseed(os.time()-os.clock()*10000)local b=function(c,d)setmetatable(c,{__index=d,__newindex=function(table,e,f)if table==c and d[e]~=nil then error('Cannot assign to read only field "'..e..'"')end;rawset(table,e,f)end})return c end;local g={FatalLogLevel=100,ErrorLogLevel=200,WarnLogLevel=300,InfoLogLevel=400,DebugLogLevel=500,TraceLogLevel=600,ColorHueSamples=10,ColorSaturationSamples=4,ColorBrightnessSamples=5,ColorMapSize=10*4*5,NegativeNumberTag='#__CYTANB_NEGATIVE_NUMBER',InstanceIDParameterName='__CYTANB_INSTANCE_ID'}local h='__CYTANB_INSTANCE_ID'local i=400;local j;local a;a={InstanceID=function()if j==''then j=vci.state.Get(h)or''end;return j end,Extend=function(k,l,m,n,o)if type(k)~='table'or type(l)~='table'then return k end;if m then if not o then o={}end;if o[l]then error('circular reference')end;o[l]=true end;for p,q in pairs(l)do local r=k[p]if m and type(q)=='table'then local s=type(r)=='table'if not n or s or r==nil then k[p]=vci.fake.Extend(s and r or{},q,m,n,o)end else if not n or r==nil then k[p]=q end end end;local t=getmetatable(l)if type(t)=='table'then local u=getmetatable(k)if not n or not u then setmetatable(k,m and vci.fake.Extend({},t,true)or t)end end;if m then o[l]=nil end;return k end,Vars=function(q,v,w,o)local x;if v then x=v~='__NOLF'else v='  'x=true end;if not w then w=''end;if not o then o={}end;local y=type(q)if y=='table'then o[q]=o[q]and o[q]+1 or 1;local z=x and w..v or''local A='('..tostring(q)..') {'local B=true;for e,C in pairs(q)do if B then B=false else A=A..(x and','or', ')end;if x then A=A..'\n'..z end;if type(C)=='table'and o[C]and o[C]>0 then A=A..e..' = ('..tostring(C)..')'else A=A..e..' = '..a.Vars(C,v,z,o)end end;if not B and x then A=A..'\n'..w end;A=A..'}'o[q]=o[q]-1;if o[q]<=0 then o[q]=nil end;return A elseif y=='function'or y=="thread"or y=="userdata"then return'('..y..')'elseif y=='string'then return'('..y..') '..string.format('%q',q)else return'('..y..') '..tostring(q)end end,GetLogLevel=function()return i end,SetLogLevel=function(D)i=D end,Log=function(D,...)if D<=i then local E=table.pack(...)if E.n==1 then local q=E[1]if q~=nil then print(type(q)=='table'and a.Vars(q)or tostring(q))else print('')end else local A=''for F=1,E.n do local q=E[F]if q~=nil then A=A..(type(q)=='table'and a.Vars(q)or tostring(q))end end;print(A)end end end,FatalLog=function(...)a.Log(g.FatalLogLevel,...)end,ErrorLog=function(...)a.Log(g.ErrorLogLevel,...)end,WarnLog=function(...)a.Log(g.WarnLogLevel,...)end,InfoLog=function(...)a.Log(g.InfoLogLevel,...)end,DebugLog=function(...)a.Log(g.DebugLogLevel,...)end,TraceLog=function(...)a.Log(g.TraceLogLevel,...)end,ListToMap=function(G,H)local table={}local I=H==nil;for p,q in pairs(G)do table[q]=I and q or H end;return table end,Random32=function()return math.random(-2147483648,2147483646)end,RandomUUID=function()return{a.Random32(),bit32.bor(0x4000,bit32.band(a.Random32(),0xFFFF0FFF)),bit32.bor(0x80000000,bit32.band(a.Random32(),0x3FFFFFFF)),a.Random32()}end,UUIDString=function(J)local K=J[2]or 0;local L=J[3]or 0;return string.format('%08x-%04x-%04x-%04x-%04x%08x',bit32.band(J[1]or 0,0xFFFFFFFF),bit32.band(bit32.rshift(K,16),0xFFFF),bit32.band(K,0xFFFF),bit32.band(bit32.rshift(L,16),0xFFFF),bit32.band(L,0xFFFF),bit32.band(J[4]or 0,0xFFFFFFFF))end,ColorFromARGB32=function(M)local N=type(M)=='number'and M or 0xFF000000;return Color.__new(bit32.band(bit32.rshift(N,16),0xFF)/0xFF,bit32.band(bit32.rshift(N,8),0xFF)/0xFF,bit32.band(N,0xFF)/0xFF,bit32.band(bit32.rshift(N,24),0xFF)/0xFF)end,ColorToARGB32=function(O)return bit32.bor(bit32.lshift(math.floor(255*O.a+0.5),24),bit32.lshift(math.floor(255*O.r+0.5),16),bit32.lshift(math.floor(255*O.g+0.5),8),math.floor(255*O.b+0.5))end,ColorFromIndex=function(P,Q,R,S,T)local U=math.max(math.floor(Q or g.ColorHueSamples),1)local V=T and U or U-1;local W=math.max(math.floor(R or g.ColorSaturationSamples),1)local X=math.max(math.floor(S or g.ColorBrightnessSamples),1)local Y=math.max(math.min(math.floor(P or 0),U*W*X-1),0)local Z=Y%U;local _=math.floor(Y/U)local a0=_%W;local a1=math.floor(_/W)if T or Z~=V then local a2=Z/V;local a3=(W-a0)/W;local q=(X-a1)/X;return Color.HSVToRGB(a2,a3,q)else local q=(X-a1)/X*a0/(W-1)return Color.HSVToRGB(0.0,0.0,q)end end,GetSubItemTransform=function(a4)local a5=a4.GetPosition()local a6=a4.GetRotation()local a7=a4.GetLocalScale()return{positionX=a5.x,positionY=a5.y,positionZ=a5.z,rotationX=a6.x,rotationY=a6.y,rotationZ=a6.z,rotationW=a6.w,scaleX=a7.x,scaleY=a7.y,scaleZ=a7.z}end,TableToSerialiable=function(a8,o)if type(a8)~='table'then return a8 end;if not o then o={}end;if o[a8]then error('circular reference')end;o[a8]=true;local a9={}for p,q in pairs(a8)do if type(q)=='number'and q<0 then a9[p..g.NegativeNumberTag]=tostring(q)else a9[p]=a.TableToSerialiable(q,o)end end;o[a8]=nil;return a9 end,TableFromSerialiable=function(a9)if type(a9)~='table'then return a9 end;local a8={}for p,q in pairs(a9)do if type(q)=='string'and string.endsWith(p,g.NegativeNumberTag)then a8[string.sub(p,1,#p-#g.NegativeNumberTag)]=tonumber(q)else a8[p]=a.TableFromSerialiable(q)end end;return a8 end,EmitMessage=function(aa,ab)local table=ab and a.TableToSerialiable(ab)or{}table[g.InstanceIDParameterName]=a.InstanceID()vci.message.Emit(aa,json.serialize(table))end,OnMessage=function(aa,ac)local ad=function(ae,af,ag)local ab;if ag==''then ab={}else local ah,a9=pcall(json.parse,ag)if not ah or type(a9)~='table'then a.TraceLog('Invalid message format: ',ag)return end;ab=a.TableFromSerialiable(a9)end;ac(ae,af,ab)end;vci.message.On(aa,ad)return{Off=function()if ad then ad=nil end end}end}b(a,g)package.loaded['cytanb']=a;if vci.assets.IsMine then j=a.UUIDString(a.RandomUUID())vci.state.Set(h,j)else j=''end;return a end)()
