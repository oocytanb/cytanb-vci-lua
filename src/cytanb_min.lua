-- cytanb | Copyright (c) 2019 oO (https://github.com/oocytanb) | MIT Licensed
---@type cytanb @See `cytanb_annotations.lua`
local cytanb=(function()math.randomseed(os.time()-os.clock()*10000)local b='__CYTANB_INSTANCE_ID'local c=400;local d;local a;a={InstanceID=function()if d==''then d=vci.state.Get(b)or''end;return d end,SetConst=function(e,f,g)if type(e)~='table'then error('Cannot set const to non-table target')end;local h=getmetatable(e)local i=h or{}local j=type(i.__index)=='table'if e[f]~=nil and(not j or i.__index[f]==nil)then error('Non-const field "'..f..'" already exists')end;if not j then i.__index={}end;local k=i.__index;k[f]=g;if not j or type(i.__newindex)~='function'then i.__newindex=function(table,l,m)if table==e and k[l]~=nil then error('Cannot assign to read only field "'..l..'"')end;rawset(table,l,m)end end;if not h then setmetatable(e,i)end;return e end,Extend=function(e,n,o,p,q)if e==n or type(e)~='table'or type(n)~='table'then return e end;if o then if not q then q={}end;if q[n]then error('circular reference')end;q[n]=true end;for r,m in pairs(n)do if o and type(m)=='table'then local s=e[r]e[r]=a.Extend(type(s)=='table'and s or{},m,o,p,q)else e[r]=m end end;if not p then local t=getmetatable(n)if type(t)=='table'then if o then local u=getmetatable(e)setmetatable(e,a.Extend(type(u)=='table'and u or{},t,true))else setmetatable(e,t)end end end;if o then q[n]=nil end;return e end,Vars=function(m,v,w,q)local x;if v then x=v~='__NOLF'else v='  'x=true end;if not w then w=''end;if not q then q={}end;local y=type(m)if y=='table'then q[m]=q[m]and q[m]+1 or 1;local z=x and w..v or''local A='('..tostring(m)..') {'local B=true;for l,C in pairs(m)do if B then B=false else A=A..(x and','or', ')end;if x then A=A..'\n'..z end;if type(C)=='table'and q[C]and q[C]>0 then A=A..l..' = ('..tostring(C)..')'else A=A..l..' = '..a.Vars(C,v,z,q)end end;if not B and x then A=A..'\n'..w end;A=A..'}'q[m]=q[m]-1;if q[m]<=0 then q[m]=nil end;return A elseif y=='function'or y=="thread"or y=="userdata"then return'('..y..')'elseif y=='string'then return'('..y..') '..string.format('%q',m)else return'('..y..') '..tostring(m)end end,GetLogLevel=function()return c end,SetLogLevel=function(D)c=D end,Log=function(D,...)if D<=c then local E=table.pack(...)if E.n==1 then local m=E[1]if m~=nil then print(type(m)=='table'and a.Vars(m)or tostring(m))else print('')end else local A=''for F=1,E.n do local m=E[F]if m~=nil then A=A..(type(m)=='table'and a.Vars(m)or tostring(m))end end;print(A)end end end,FatalLog=function(...)a.Log(a.FatalLogLevel,...)end,ErrorLog=function(...)a.Log(a.ErrorLogLevel,...)end,WarnLog=function(...)a.Log(a.WarnLogLevel,...)end,InfoLog=function(...)a.Log(a.InfoLogLevel,...)end,DebugLog=function(...)a.Log(a.DebugLogLevel,...)end,TraceLog=function(...)a.Log(a.TraceLogLevel,...)end,ListToMap=function(G,H)local table={}local I=H==nil;for r,m in pairs(G)do table[m]=I and m or H end;return table end,Random32=function()return math.random(-2147483648,2147483646)end,RandomUUID=function()return{a.Random32(),bit32.bor(0x4000,bit32.band(a.Random32(),0xFFFF0FFF)),bit32.bor(0x80000000,bit32.band(a.Random32(),0x3FFFFFFF)),a.Random32()}end,UUIDString=function(J)local K=J[2]or 0;local L=J[3]or 0;return string.format('%08x-%04x-%04x-%04x-%04x%08x',bit32.band(J[1]or 0,0xFFFFFFFF),bit32.band(bit32.rshift(K,16),0xFFFF),bit32.band(K,0xFFFF),bit32.band(bit32.rshift(L,16),0xFFFF),bit32.band(L,0xFFFF),bit32.band(J[4]or 0,0xFFFFFFFF))end,ColorFromARGB32=function(M)local N=type(M)=='number'and M or 0xFF000000;return Color.__new(bit32.band(bit32.rshift(N,16),0xFF)/0xFF,bit32.band(bit32.rshift(N,8),0xFF)/0xFF,bit32.band(N,0xFF)/0xFF,bit32.band(bit32.rshift(N,24),0xFF)/0xFF)end,ColorToARGB32=function(O)return bit32.bor(bit32.lshift(math.floor(255*O.a+0.5),24),bit32.lshift(math.floor(255*O.r+0.5),16),bit32.lshift(math.floor(255*O.g+0.5),8),math.floor(255*O.b+0.5))end,ColorFromIndex=function(P,Q,R,S,T)local U=math.max(math.floor(Q or a.ColorHueSamples),1)local V=T and U or U-1;local W=math.max(math.floor(R or a.ColorSaturationSamples),1)local X=math.max(math.floor(S or a.ColorBrightnessSamples),1)local Y=math.max(math.min(math.floor(P or 0),U*W*X-1),0)local Z=Y%U;local _=math.floor(Y/U)local a0=_%W;local a1=math.floor(_/W)if T or Z~=V then local a2=Z/V;local a3=(W-a0)/W;local m=(X-a1)/X;return Color.HSVToRGB(a2,a3,m)else local m=(X-a1)/X*a0/(W-1)return Color.HSVToRGB(0.0,0.0,m)end end,GetSubItemTransform=function(a4)local a5=a4.GetPosition()local a6=a4.GetRotation()local a7=a4.GetLocalScale()return{positionX=a5.x,positionY=a5.y,positionZ=a5.z,rotationX=a6.x,rotationY=a6.y,rotationZ=a6.z,rotationW=a6.w,scaleX=a7.x,scaleY=a7.y,scaleZ=a7.z}end,TableToSerialiable=function(a8,q)if type(a8)~='table'then return a8 end;if not q then q={}end;if q[a8]then error('circular reference')end;q[a8]=true;local a9={}for r,m in pairs(a8)do if type(m)=='number'and m<0 then a9[r..a.NegativeNumberTag]=tostring(m)else a9[r]=a.TableToSerialiable(m,q)end end;q[a8]=nil;return a9 end,TableFromSerialiable=function(a9)if type(a9)~='table'then return a9 end;local a8={}for r,m in pairs(a9)do if type(m)=='string'and string.endsWith(r,a.NegativeNumberTag)then a8[string.sub(r,1,#r-#a.NegativeNumberTag)]=tonumber(m)else a8[r]=a.TableFromSerialiable(m)end end;return a8 end,EmitMessage=function(f,aa)local table=aa and a.TableToSerialiable(aa)or{}table[a.InstanceIDParameterName]=a.InstanceID()vci.message.Emit(f,json.serialize(table))end,OnMessage=function(f,ab)local ac=function(ad,ae,af)local aa;if af==''then aa={}else local ag,a9=pcall(json.parse,af)if not ag or type(a9)~='table'then a.TraceLog('Invalid message format: ',af)return end;aa=a.TableFromSerialiable(a9)end;ab(ad,ae,aa)end;vci.message.On(f,ac)return{Off=function()if ac then ac=nil end end}end}a:SetConst('FatalLogLevel',100):SetConst('ErrorLogLevel',200):SetConst('WarnLogLevel',300):SetConst('InfoLogLevel',400):SetConst('DebugLogLevel',500):SetConst('TraceLogLevel',600):SetConst('ColorHueSamples',10):SetConst('ColorSaturationSamples',4):SetConst('ColorBrightnessSamples',5):SetConst('ColorMapSize',a.ColorHueSamples*a.ColorSaturationSamples*a.ColorBrightnessSamples):SetConst('NegativeNumberTag','#__CYTANB_NEGATIVE_NUMBER'):SetConst('InstanceIDParameterName','__CYTANB_INSTANCE_ID')package.loaded['cytanb']=a;if vci.assets.IsMine then d=a.UUIDString(a.RandomUUID())vci.state.Set(b,d)else d=''end;return a end)()
