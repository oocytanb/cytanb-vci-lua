-- cytanb | Copyright (c) 2019 oO (https://github.com/oocytanb) | MIT Licensed
---@type cytanb @See `cytanb_annotations.lua`
local cytanb=(function()math.randomseed(os.time()-os.clock()*10000)local b='__CYTANB_INSTANCE_ID'local c=400;local d;local a;local e=function(f,g)for h=1,4 do local i=f[h]-g[h]if i~=0 then return i end end;return 0 end;local j;j={__eq=function(f,g)return f[1]==g[1]and f[2]==g[2]and f[3]==g[3]and f[4]==g[4]end,__lt=function(f,g)return e(f,g)<0 end,__le=function(f,g)return e(f,g)<=0 end,__tostring=function(k)local l=k[2]or 0;local m=k[3]or 0;return string.format('%08x-%04x-%04x-%04x-%04x%08x',bit32.band(k[1]or 0,0xFFFFFFFF),bit32.band(bit32.rshift(l,16),0xFFFF),bit32.band(l,0xFFFF),bit32.band(bit32.rshift(m,16),0xFFFF),bit32.band(m,0xFFFF),bit32.band(k[4]or 0,0xFFFFFFFF))end,__concat=function(f,g)local n=getmetatable(f)==j;local o=getmetatable(g)==j;if not n and not o then error('attempt to concatenate illegal values')end;return(n and tostring(f)or f)..(o and tostring(g)or g)end}a={InstanceID=function()if d==''then d=vci.state.Get(b)or''end;return d end,SetConst=function(p,q,k)if type(p)~='table'then error('Cannot set const to non-table target')end;local r=getmetatable(p)local s=r or{}local t=type(s.__index)=='table'if p[q]~=nil and(not t or s.__index[q]==nil)then error('Non-const field "'..q..'" already exists')end;if not t then s.__index={}end;local u=s.__index;u[q]=k;if not t or type(s.__newindex)~='function'then s.__newindex=function(table,v,w)if table==p and u[v]~=nil then error('Cannot assign to read only field "'..v..'"')end;rawset(table,v,w)end end;if not r then setmetatable(p,s)end;return p end,Extend=function(p,x,y,z,A)if p==x or type(p)~='table'or type(x)~='table'then return p end;if y then if not A then A={}end;if A[x]then error('circular reference')end;A[x]=true end;for B,w in pairs(x)do if y and type(w)=='table'then local C=p[B]p[B]=a.Extend(type(C)=='table'and C or{},w,y,z,A)else p[B]=w end end;if not z then local D=getmetatable(x)if type(D)=='table'then if y then local E=getmetatable(p)setmetatable(p,a.Extend(type(E)=='table'and E or{},D,true))else setmetatable(p,D)end end end;if y then A[x]=nil end;return p end,Vars=function(w,F,G,A)local H;if F then H=F~='__NOLF'else F='  'H=true end;if not G then G=''end;if not A then A={}end;local I=type(w)if I=='table'then A[w]=A[w]and A[w]+1 or 1;local J=H and G..F or''local K='('..tostring(w)..') {'local L=true;for v,M in pairs(w)do if L then L=false else K=K..(H and','or', ')end;if H then K=K..'\n'..J end;if type(M)=='table'and A[M]and A[M]>0 then K=K..v..' = ('..tostring(M)..')'else K=K..v..' = '..a.Vars(M,F,J,A)end end;if not L and H then K=K..'\n'..G end;K=K..'}'A[w]=A[w]-1;if A[w]<=0 then A[w]=nil end;return K elseif I=='function'or I=='thread'or I=='userdata'then return'('..I..')'elseif I=='string'then return'('..I..') '..string.format('%q',w)else return'('..I..') '..tostring(w)end end,GetLogLevel=function()return c end,SetLogLevel=function(N)c=N end,Log=function(N,...)if N<=c then local O=table.pack(...)if O.n==1 then local w=O[1]if w~=nil then print(type(w)=='table'and a.Vars(w)or tostring(w))else print('')end else local K=''for h=1,O.n do local w=O[h]if w~=nil then K=K..(type(w)=='table'and a.Vars(w)or tostring(w))end end;print(K)end end end,LogFatal=function(...)a.Log(a.LogLevelFatal,...)end,LogError=function(...)a.Log(a.LogLevelError,...)end,LogWarn=function(...)a.Log(a.LogLevelWarn,...)end,LogInfo=function(...)a.Log(a.LogLevelInfo,...)end,LogDebug=function(...)a.Log(a.LogLevelDebug,...)end,LogTrace=function(...)a.Log(a.LogLevelTrace,...)end,FatalLog=function(...)a.LogFatal(...)end,ErrorLog=function(...)a.LogError(...)end,WarnLog=function(...)a.LogWarn(...)end,InfoLog=function(...)a.LogInfo(...)end,DebugLog=function(...)a.LogDebug(...)end,TraceLog=function(...)a.LogTrace(...)end,ListToMap=function(P,Q)local table={}local R=Q==nil;for B,w in pairs(P)do table[w]=R and w or Q end;return table end,Round=function(S,T)if T then local U=math.pow(10,T)return math.floor(S*U+0.5)/U else return math.floor(S+0.5)end end,Lerp=function(V,W,I)if I<=0.0 then return V elseif I>=1.0 then return W else return V+(W-V)*I end end,LerpUnclamped=function(V,W,I)return V+(W-V)*I end,Random32=function()return bit32.band(math.random(-2147483648,2147483646),0xFFFFFFFF)end,RandomUUID=function()return a.UUIDFromNumbers(a.Random32(),bit32.bor(0x4000,bit32.band(a.Random32(),0xFFFF0FFF)),bit32.bor(0x80000000,bit32.band(a.Random32(),0x3FFFFFFF)),a.Random32())end,UUIDString=function(X)return j.__tostring(X)end,UUIDFromNumbers=function(Y,Z,_,a0)local X={Y or 0,Z or 0,_ or 0,a0 or 0}setmetatable(X,j)return X end,UUIDFromString=function(K)local a1=string.len(K)if a1~=32 and a1~=36 then return nil end;local a2='[0-9a-f-A-F]+'local a3='^('..a2 ..')$'local a4='^-('..a2 ..')$'local a5,a6,a7,a8;if a1==32 then local X=a.UUIDFromNumbers(0,0,0,0)local a9=1;for h,aa in ipairs({8,16,24,32})do a5,a6,a7=string.find(string.sub(K,a9,aa),a3)if not a5 then return nil end;X[h]=tonumber(a7,16)a9=aa+1 end;return X else a5,a6,a7=string.find(string.sub(K,1,8),a3)if not a5 then return nil end;local Y=tonumber(a7,16)a5,a6,a7=string.find(string.sub(K,9,13),a4)if not a5 then return nil end;a5,a6,a8=string.find(string.sub(K,14,18),a4)if not a5 then return nil end;local Z=tonumber(a7 ..a8,16)a5,a6,a7=string.find(string.sub(K,19,23),a4)if not a5 then return nil end;a5,a6,a8=string.find(string.sub(K,24,28),a4)if not a5 then return nil end;local _=tonumber(a7 ..a8,16)a5,a6,a7=string.find(string.sub(K,29,36),a3)if not a5 then return nil end;local a0=tonumber(a7,16)return a.UUIDFromNumbers(Y,Z,_,a0)end end,ParseUUID=function(K)return a.UUIDFromString(K)end,ColorFromARGB32=function(ab)local ac=type(ab)=='number'and ab or 0xFF000000;return Color.__new(bit32.band(bit32.rshift(ac,16),0xFF)/0xFF,bit32.band(bit32.rshift(ac,8),0xFF)/0xFF,bit32.band(ac,0xFF)/0xFF,bit32.band(bit32.rshift(ac,24),0xFF)/0xFF)end,ColorToARGB32=function(ad)return bit32.bor(bit32.lshift(bit32.band(a.Round(0xFF*ad.a),0xFF),24),bit32.lshift(bit32.band(a.Round(0xFF*ad.r),0xFF),16),bit32.lshift(bit32.band(a.Round(0xFF*ad.g),0xFF),8),bit32.band(a.Round(0xFF*ad.b),0xFF))end,ColorFromIndex=function(ae,af,ag,ah,ai)local aj=math.max(math.floor(af or a.ColorHueSamples),1)local ak=ai and aj or aj-1;local al=math.max(math.floor(ag or a.ColorSaturationSamples),1)local am=math.max(math.floor(ah or a.ColorBrightnessSamples),1)local an=math.max(math.min(math.floor(ae or 0),aj*al*am-1),0)local ao=an%aj;local ap=math.floor(an/aj)local aq=ap%al;local ar=math.floor(ap/al)if ai or ao~=ak then local as=ao/ak;local at=(al-aq)/al;local w=(am-ar)/am;return Color.HSVToRGB(as,at,w)else local w=(am-ar)/am*aq/(al-1)return Color.HSVToRGB(0.0,0.0,w)end end,GetSubItemTransform=function(au)local av=au.GetPosition()local aw=au.GetRotation()local ax=au.GetLocalScale()return{positionX=av.x,positionY=av.y,positionZ=av.z,rotationX=aw.x,rotationY=aw.y,rotationZ=aw.z,rotationW=aw.w,scaleX=ax.x,scaleY=ax.y,scaleZ=ax.z}end,TableToSerializable=function(ay,A)if type(ay)~='table'then return ay end;if not A then A={}end;if A[ay]then error('circular reference')end;A[ay]=true;local az={}for B,w in pairs(ay)do local aA=type(B)=='number'and tostring(B)..a.ArrayNumberTag or B;if type(w)=='number'and w<0 then az[tostring(aA)..a.NegativeNumberTag]=tostring(w)else az[aA]=a.TableToSerializable(w,A)end end;A[ay]=nil;return az end,TableFromSerializable=function(az)if type(az)~='table'then return az end;local ay={}for B,w in pairs(az)do local aA;local aB;if type(B)=='string'then if string.endsWith(B,a.NegativeNumberTag)then aA=string.sub(B,1,-1-#a.NegativeNumberTag)aB=true else aA=B;aB=false end;if string.endsWith(aA,a.ArrayNumberTag)then local aC=string.sub(aA,1,-1-#a.ArrayNumberTag)aA=tonumber(aC)or aC end else aA=B;aB=false end;ay[aA]=aB and type(w)=='string'and tonumber(w)or a.TableFromSerializable(w)end;return ay end,TableToSerialiable=function(ay,A)return a.TableToSerializable(ay,A)end,TableFromSerialiable=function(az)return a.TableFromSerializable(az)end,EmitMessage=function(q,aD)local table=aD and a.TableToSerializable(aD)or{}table[a.InstanceIDParameterName]=a.InstanceID()vci.message.Emit(q,json.serialize(table))end,OnMessage=function(q,aE)local aF=function(aG,aH,aI)local aJ=nil;if aG.type~='comment'and type(aI)=='string'then local aK,az=pcall(json.parse,aI)if aK and type(az)=='table'then aJ=a.TableFromSerializable(az)end end;local aD=aJ and aJ or{[a.MessageValueParameterName]=aI}aE(aG,aH,aD)end;vci.message.On(q,aF)return{Off=function()if aF then aF=nil end end}end}a:SetConst('LogLevelFatal',100):SetConst('LogLevelError',200):SetConst('LogLevelWarn',300):SetConst('LogLevelInfo',400):SetConst('LogLevelDebug',500):SetConst('LogLevelTrace',600):SetConst('FatalLogLevel',a.LogLevelFatal):SetConst('ErrorLogLevel',a.LogLevelError):SetConst('WarnLogLevel',a.LogLevelWarn):SetConst('InfoLogLevel',a.LogLevelInfo):SetConst('DebugLogLevel',a.LogLevelDebug):SetConst('TraceLogLevel',a.LogLevelTrace):SetConst('ColorHueSamples',10):SetConst('ColorSaturationSamples',4):SetConst('ColorBrightnessSamples',5):SetConst('ColorMapSize',a.ColorHueSamples*a.ColorSaturationSamples*a.ColorBrightnessSamples):SetConst('NegativeNumberTag','#__CYTANB_NEGATIVE_NUMBER'):SetConst('ArrayNumberTag','#__CYTANB_ARRAY_NUMBER'):SetConst('InstanceIDParameterName','__CYTANB_INSTANCE_ID'):SetConst('MessageValueParameterName','__CYTANB_MESSAGE_VALUE')package.loaded['cytanb']=a;if vci.assets.IsMine then d=tostring(a.RandomUUID())vci.state.Set(b,d)else d=''end;return a end)()
