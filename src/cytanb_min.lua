-- cytanb | Copyright (c) 2019 oO (https://github.com/oocytanb) | MIT Licensed
---@type cytanb @See `cytanb_annotations.lua`
local cytanb=(function()math.randomseed(os.time()-os.clock()*10000)local b='__CYTANB_INSTANCE_ID'local c=400;local d;local a;local e=function(f,g)for h=1,4 do local i=f[h]-g[h]if i~=0 then return i end end;return 0 end;local j;j={__eq=function(f,g)return f[1]==g[1]and f[2]==g[2]and f[3]==g[3]and f[4]==g[4]end,__lt=function(f,g)return e(f,g)<0 end,__le=function(f,g)return e(f,g)<=0 end,__tostring=function(k)local l=k[2]or 0;local m=k[3]or 0;return string.format('%08x-%04x-%04x-%04x-%04x%08x',bit32.band(k[1]or 0,0xFFFFFFFF),bit32.band(bit32.rshift(l,16),0xFFFF),bit32.band(l,0xFFFF),bit32.band(bit32.rshift(m,16),0xFFFF),bit32.band(m,0xFFFF),bit32.band(k[4]or 0,0xFFFFFFFF))end,__concat=function(f,g)local n=getmetatable(f)local o=n==j or type(n)=='table'and n.__concat==j.__concat;local p=getmetatable(g)local q=p==j or type(p)=='table'and p.__concat==j.__concat;if not o and not q then error('attempt to concatenate illegal values')end;return(o and j.__tostring(f)or f)..(q and j.__tostring(g)or g)end}a={InstanceID=function()if d==''then d=vci.state.Get(b)or''end;return d end,SetConst=function(r,s,k)if type(r)~='table'then error('Cannot set const to non-table target')end;local t=getmetatable(r)local u=t or{}local v=u.__CYTANB_CONST_VARIABLES;if r[s]~=nil and(not v or v[s]==nil)then error('Non-const field "'..s..'" already exists')end;if not v then v={}u.__CYTANB_CONST_VARIABLES=v;u.__index=function(table,w)local x=v[w]if type(x)=='function'then return x(table,w)else return x end end;u.__newindex=function(table,w,y)if table==r and v[w]~=nil then error('Cannot assign to read only field "'..w..'"')end;rawset(table,w,y)end end;v[s]=k;if not t then setmetatable(r,u)end;return r end,SetConstEach=function(r,z)for A,y in pairs(z)do a.SetConst(r,A,y)end;return r end,Extend=function(r,B,C,D,E)if r==B or type(r)~='table'or type(B)~='table'then return r end;if C then if not E then E={}end;if E[B]then error('circular reference')end;E[B]=true end;for A,y in pairs(B)do if C and type(y)=='table'then local F=r[A]r[A]=a.Extend(type(F)=='table'and F or{},y,C,D,E)else r[A]=y end end;if not D then local G=getmetatable(B)if type(G)=='table'then if C then local H=getmetatable(r)setmetatable(r,a.Extend(type(H)=='table'and H or{},G,true))else setmetatable(r,G)end end end;if C then E[B]=nil end;return r end,Vars=function(y,I,J,E)local K;if I then K=I~='__NOLF'else I='  'K=true end;if not J then J=''end;if not E then E={}end;local L=type(y)if L=='table'then E[y]=E[y]and E[y]+1 or 1;local M=K and J..I or''local N='('..tostring(y)..') {'local O=true;for w,P in pairs(y)do if O then O=false else N=N..(K and','or', ')end;if K then N=N..'\n'..M end;if type(P)=='table'and E[P]and E[P]>0 then N=N..w..' = ('..tostring(P)..')'else N=N..w..' = '..a.Vars(P,I,M,E)end end;if not O and K then N=N..'\n'..J end;N=N..'}'E[y]=E[y]-1;if E[y]<=0 then E[y]=nil end;return N elseif L=='function'or L=='thread'or L=='userdata'then return'('..L..')'elseif L=='string'then return'('..L..') '..string.format('%q',y)else return'('..L..') '..tostring(y)end end,GetLogLevel=function()return c end,SetLogLevel=function(Q)c=Q end,Log=function(Q,...)if Q<=c then local R=table.pack(...)if R.n==1 then local y=R[1]if y~=nil then print(type(y)=='table'and a.Vars(y)or tostring(y))else print('')end else local N=''for h=1,R.n do local y=R[h]if y~=nil then N=N..(type(y)=='table'and a.Vars(y)or tostring(y))end end;print(N)end end end,LogFatal=function(...)a.Log(a.LogLevelFatal,...)end,LogError=function(...)a.Log(a.LogLevelError,...)end,LogWarn=function(...)a.Log(a.LogLevelWarn,...)end,LogInfo=function(...)a.Log(a.LogLevelInfo,...)end,LogDebug=function(...)a.Log(a.LogLevelDebug,...)end,LogTrace=function(...)a.Log(a.LogLevelTrace,...)end,FatalLog=function(...)a.LogFatal(...)end,ErrorLog=function(...)a.LogError(...)end,WarnLog=function(...)a.LogWarn(...)end,InfoLog=function(...)a.LogInfo(...)end,DebugLog=function(...)a.LogDebug(...)end,TraceLog=function(...)a.LogTrace(...)end,ListToMap=function(S,T)local table={}local U=T==nil;for A,y in pairs(S)do table[y]=U and y or T end;return table end,Round=function(V,W)if W then local X=math.pow(10,W)return math.floor(V*X+0.5)/X else return math.floor(V+0.5)end end,Lerp=function(Y,Z,L)if L<=0.0 then return Y elseif L>=1.0 then return Z else return Y+(Z-Y)*L end end,LerpUnclamped=function(Y,Z,L)return Y+(Z-Y)*L end,Random32=function()return bit32.band(math.random(-2147483648,2147483646),0xFFFFFFFF)end,RandomUUID=function()return a.UUIDFromNumbers(a.Random32(),bit32.bor(0x4000,bit32.band(a.Random32(),0xFFFF0FFF)),bit32.bor(0x80000000,bit32.band(a.Random32(),0x3FFFFFFF)),a.Random32())end,UUIDString=function(_)return j.__tostring(_)end,UUIDFromNumbers=function(...)local a0=...local L=type(a0)local a1,a2,a3,a4;if L=='table'then a1=a0[1]a2=a0[2]a3=a0[3]a4=a0[4]else a1,a2,a3,a4=...end;local _={bit32.band(a1 or 0,0xFFFFFFFF),bit32.band(a2 or 0,0xFFFFFFFF),bit32.band(a3 or 0,0xFFFFFFFF),bit32.band(a4 or 0,0xFFFFFFFF)}setmetatable(_,j)return _ end,UUIDFromString=function(N)local a5=string.len(N)if a5~=32 and a5~=36 then return nil end;local a6='[0-9a-f-A-F]+'local a7='^('..a6 ..')$'local a8='^-('..a6 ..')$'local a9,aa,ab,ac;if a5==32 then local _=a.UUIDFromNumbers(0,0,0,0)local ad=1;for h,ae in ipairs({8,16,24,32})do a9,aa,ab=string.find(string.sub(N,ad,ae),a7)if not a9 then return nil end;_[h]=tonumber(ab,16)ad=ae+1 end;return _ else a9,aa,ab=string.find(string.sub(N,1,8),a7)if not a9 then return nil end;local a1=tonumber(ab,16)a9,aa,ab=string.find(string.sub(N,9,13),a8)if not a9 then return nil end;a9,aa,ac=string.find(string.sub(N,14,18),a8)if not a9 then return nil end;local a2=tonumber(ab..ac,16)a9,aa,ab=string.find(string.sub(N,19,23),a8)if not a9 then return nil end;a9,aa,ac=string.find(string.sub(N,24,28),a8)if not a9 then return nil end;local a3=tonumber(ab..ac,16)a9,aa,ab=string.find(string.sub(N,29,36),a7)if not a9 then return nil end;local a4=tonumber(ab,16)return a.UUIDFromNumbers(a1,a2,a3,a4)end end,ParseUUID=function(N)return a.UUIDFromString(N)end,ColorFromARGB32=function(af)local ag=type(af)=='number'and af or 0xFF000000;return Color.__new(bit32.band(bit32.rshift(ag,16),0xFF)/0xFF,bit32.band(bit32.rshift(ag,8),0xFF)/0xFF,bit32.band(ag,0xFF)/0xFF,bit32.band(bit32.rshift(ag,24),0xFF)/0xFF)end,ColorToARGB32=function(ah)return bit32.bor(bit32.lshift(bit32.band(a.Round(0xFF*ah.a),0xFF),24),bit32.lshift(bit32.band(a.Round(0xFF*ah.r),0xFF),16),bit32.lshift(bit32.band(a.Round(0xFF*ah.g),0xFF),8),bit32.band(a.Round(0xFF*ah.b),0xFF))end,ColorFromIndex=function(ai,aj,ak,al,am)local an=math.max(math.floor(aj or a.ColorHueSamples),1)local ao=am and an or an-1;local ap=math.max(math.floor(ak or a.ColorSaturationSamples),1)local aq=math.max(math.floor(al or a.ColorBrightnessSamples),1)local ar=math.max(math.min(math.floor(ai or 0),an*ap*aq-1),0)local as=ar%an;local at=math.floor(ar/an)local au=at%ap;local av=math.floor(at/ap)if am or as~=ao then local aw=as/ao;local ax=(ap-au)/ap;local y=(aq-av)/aq;return Color.HSVToRGB(aw,ax,y)else local y=(aq-av)/aq*au/(ap-1)return Color.HSVToRGB(0.0,0.0,y)end end,GetSubItemTransform=function(ay)local az=ay.GetPosition()local aA=ay.GetRotation()local aB=ay.GetLocalScale()return{positionX=az.x,positionY=az.y,positionZ=az.z,rotationX=aA.x,rotationY=aA.y,rotationZ=aA.z,rotationW=aA.w,scaleX=aB.x,scaleY=aB.y,scaleZ=aB.z}end,TableToSerializable=function(aC,E)if type(aC)~='table'then return aC end;if not E then E={}end;if E[aC]then error('circular reference')end;E[aC]=true;local aD={}for A,y in pairs(aC)do local aE=type(A)=='number'and tostring(A)..a.ArrayNumberTag or A;if type(y)=='number'and y<0 then aD[tostring(aE)..a.NegativeNumberTag]=tostring(y)else aD[aE]=a.TableToSerializable(y,E)end end;E[aC]=nil;return aD end,TableFromSerializable=function(aD)if type(aD)~='table'then return aD end;local aC={}for A,y in pairs(aD)do local aE;local aF;if type(A)=='string'then if string.endsWith(A,a.NegativeNumberTag)then aE=string.sub(A,1,-1-#a.NegativeNumberTag)aF=true else aE=A;aF=false end;if string.endsWith(aE,a.ArrayNumberTag)then local aG=string.sub(aE,1,-1-#a.ArrayNumberTag)aE=tonumber(aG)or aG end else aE=A;aF=false end;aC[aE]=aF and type(y)=='string'and tonumber(y)or a.TableFromSerializable(y)end;return aC end,TableToSerialiable=function(aC,E)return a.TableToSerializable(aC,E)end,TableFromSerialiable=function(aD)return a.TableFromSerializable(aD)end,EmitMessage=function(s,aH)local table=aH and a.TableToSerializable(aH)or{}table[a.InstanceIDParameterName]=a.InstanceID()vci.message.Emit(s,json.serialize(table))end,OnMessage=function(s,aI)local aJ=function(aK,aL,aM)local aN=nil;if aK.type~='comment'and type(aM)=='string'then local aO,aD=pcall(json.parse,aM)if aO and type(aD)=='table'then aN=a.TableFromSerializable(aD)end end;local aH=aN and aN or{[a.MessageValueParameterName]=aM}aI(aK,aL,aH)end;vci.message.On(s,aJ)return{Off=function()if aJ then aJ=nil end end}end}a.SetConstEach(a,{LogLevelFatal=100,LogLevelError=200,LogLevelWarn=300,LogLevelInfo=400,LogLevelDebug=500,LogLevelTrace=600,ColorHueSamples=10,ColorSaturationSamples=4,ColorBrightnessSamples=5,NegativeNumberTag='#__CYTANB_NEGATIVE_NUMBER',ArrayNumberTag='#__CYTANB_ARRAY_NUMBER',InstanceIDParameterName='__CYTANB_INSTANCE_ID',MessageValueParameterName='__CYTANB_MESSAGE_VALUE'})a.SetConstEach(a,{ColorMapSize=a.ColorHueSamples*a.ColorSaturationSamples*a.ColorBrightnessSamples,FatalLogLevel=a.LogLevelFatal,ErrorLogLevel=a.LogLevelError,WarnLogLevel=a.LogLevelWarn,InfoLogLevel=a.LogLevelInfo,DebugLogLevel=a.LogLevelDebug,TraceLogLevel=a.LogLevelTrace})package.loaded['cytanb']=a;if vci.assets.IsMine then d=tostring(a.RandomUUID())vci.state.Set(b,d)else d=''end;return a end)()
