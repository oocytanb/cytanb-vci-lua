-- cytanb | Copyright (c) 2019 oO (https://github.com/oocytanb) | MIT Licensed
---@type cytanb @See `cytanb_annotations.lua`
local cytanb=(function()math.randomseed(os.time()-os.clock()*10000)local b='__CYTANB_INSTANCE_ID'local c;local d;local e;local f;local g=false;local h;local i;local a;local j=function(k,l)for m=1,4 do local n=k[m]-l[m]if n~=0 then return n end end;return 0 end;local o;o={__eq=function(k,l)return k[1]==l[1]and k[2]==l[2]and k[3]==l[3]and k[4]==l[4]end,__lt=function(k,l)return j(k,l)<0 end,__le=function(k,l)return j(k,l)<=0 end,__tostring=function(p)local q=p[2]or 0;local r=p[3]or 0;return string.format('%08x-%04x-%04x-%04x-%04x%08x',bit32.band(p[1]or 0,0xFFFFFFFF),bit32.band(bit32.rshift(q,16),0xFFFF),bit32.band(q,0xFFFF),bit32.band(bit32.rshift(r,16),0xFFFF),bit32.band(r,0xFFFF),bit32.band(p[4]or 0,0xFFFFFFFF))end,__concat=function(k,l)local s=getmetatable(k)local t=s==o or type(s)=='table'and s.__concat==o.__concat;local u=getmetatable(l)local v=u==o or type(u)=='table'and u.__concat==o.__concat;if not t and not v then error('attempt to concatenate illegal values',2)end;return(t and o.__tostring(k)or k)..(v and o.__tostring(l)or l)end}local w='__CYTANB_CONST_VARIABLES'local x=function(table,y)local z=getmetatable(table)if z then local A=rawget(z,w)if A then local B=rawget(A,y)if type(B)=='function'then return B(table,y)else return B end end end;return nil end;local C=function(table,y,D)local z=getmetatable(table)if z then local A=rawget(z,w)if A then if rawget(A,y)~=nil then error('Cannot assign to read only field "'..y..'"',2)end end end;rawset(table,y,D)end;local E=function(F,G)local H=F[a.TypeParameterName]if a.NillableHasValue(H)and a.NillableValue(H)~=G then return false,false end;local I=c[G]local J=I.nameMap;local K=I.length;local L=false;for M,D in pairs(F)do if J[M]then K=K-1;if K<=0 and L then break end elseif M~=a.TypeParameterName then L=true;if K<=0 then break end end end;return K<=0,L end;local N=function(O)return string.gsub(string.gsub(O,a.EscapeSequenceTag,a.EscapeSequenceTag..a.EscapeSequenceTag),'/',a.SolidusTag)end;local P=function(O,Q)local R=string.len(O)local S=string.len(a.EscapeSequenceTag)if S>R then return O end;local T=''local m=1;while m<R do local U,V=string.find(O,a.EscapeSequenceTag,m,true)if not U then if m==1 then T=O else T=T..string.sub(O,m)end;break end;if U>m then T=T..string.sub(O,m,U-1)end;local W=false;for X,Y in ipairs(d)do local Z,_=string.find(O,Y.pattern,U)if Z then T=T..(Q and Q(Y.tag)or Y.replacement)m=_+1;W=true;break end end;if not W then T=T..a.EscapeSequenceTag;m=V+1 end end;return T end;a={InstanceID=function()if i==''then i=vci.state.Get(b)or''end;return i end,NillableHasValue=function(a0)return a0~=nil end,NillableValue=function(a0)if a0==nil then error('value is nil',2)end;return a0 end,NillableValueOrDefault=function(a0,a1)if a0==nil then if a1==nil then error('defaultValue is nil',2)end;return a1 else return a0 end end,SetConst=function(a2,a3,p)if type(a2)~='table'then error('Cannot set const to non-table target',2)end;local a4=getmetatable(a2)local z=a4 or{}local a5=rawget(z,w)if rawget(a2,a3)~=nil then error('Non-const field "'..a3 ..'" already exists',2)end;if not a5 then a5={}rawset(z,w,a5)z.__index=x;z.__newindex=C end;rawset(a5,a3,p)if not a4 then setmetatable(a2,z)end;return a2 end,SetConstEach=function(a2,a6)for M,D in pairs(a6)do a.SetConst(a2,M,D)end;return a2 end,Extend=function(a2,a7,a8,a9,aa)if a2==a7 or type(a2)~='table'or type(a7)~='table'then return a2 end;if a8 then if not aa then aa={}end;if aa[a7]then error('circular reference')end;aa[a7]=true end;for M,D in pairs(a7)do if a8 and type(D)=='table'then local ab=a2[M]a2[M]=a.Extend(type(ab)=='table'and ab or{},D,a8,a9,aa)else a2[M]=D end end;if not a9 then local ac=getmetatable(a7)if type(ac)=='table'then if a8 then local ad=getmetatable(a2)setmetatable(a2,a.Extend(type(ad)=='table'and ad or{},ac,true))else setmetatable(a2,ac)end end end;if a8 then aa[a7]=nil end;return a2 end,Vars=function(D,ae,af,aa)local ag;if ae then ag=ae~='__NOLF'else ae='  'ag=true end;if not af then af=''end;if not aa then aa={}end;local ah=type(D)if ah=='table'then aa[D]=aa[D]and aa[D]+1 or 1;local ai=ag and af..ae or''local O='('..tostring(D)..') {'local aj=true;for y,ak in pairs(D)do if aj then aj=false else O=O..(ag and','or', ')end;if ag then O=O..'\n'..ai end;if type(ak)=='table'and aa[ak]and aa[ak]>0 then O=O..y..' = ('..tostring(ak)..')'else O=O..y..' = '..a.Vars(ak,ae,ai,aa)end end;if not aj and ag then O=O..'\n'..af end;O=O..'}'aa[D]=aa[D]-1;if aa[D]<=0 then aa[D]=nil end;return O elseif ah=='function'or ah=='thread'or ah=='userdata'then return'('..ah..')'elseif ah=='string'then return'('..ah..') '..string.format('%q',D)else return'('..ah..') '..tostring(D)end end,GetLogLevel=function()return f end,SetLogLevel=function(al)f=al end,IsOutputLogLevelEnabled=function()return g end,SetOutputLogLevelEnabled=function(am)g=not not am end,Log=function(al,...)if al<=f then local an=g and(h[al]or'LOG LEVEL '..tostring(al))..' | 'or''local ao=table.pack(...)if ao.n==1 then local D=ao[1]if D~=nil then local O=type(D)=='table'and a.Vars(D)or tostring(D)print(g and an..O or O)else print(an)end else local O=an;for m=1,ao.n do local D=ao[m]if D~=nil then O=O..(type(D)=='table'and a.Vars(D)or tostring(D))end end;print(O)end end end,LogFatal=function(...)a.Log(a.LogLevelFatal,...)end,LogError=function(...)a.Log(a.LogLevelError,...)end,LogWarn=function(...)a.Log(a.LogLevelWarn,...)end,LogInfo=function(...)a.Log(a.LogLevelInfo,...)end,LogDebug=function(...)a.Log(a.LogLevelDebug,...)end,LogTrace=function(...)a.Log(a.LogLevelTrace,...)end,FatalLog=function(...)a.LogFatal(...)end,ErrorLog=function(...)a.LogError(...)end,WarnLog=function(...)a.LogWarn(...)end,InfoLog=function(...)a.LogInfo(...)end,DebugLog=function(...)a.LogDebug(...)end,TraceLog=function(...)a.LogTrace(...)end,ListToMap=function(ap,aq)local table={}local ar=aq==nil;for M,D in pairs(ap)do table[D]=ar and D or aq end;return table end,Round=function(as,at)if at then local au=10^at;return math.floor(as*au+0.5)/au else return math.floor(as+0.5)end end,Clamp=function(p,av,aw)return math.max(av,math.min(p,aw))end,Lerp=function(ax,ay,ah)if ah<=0.0 then return ax elseif ah>=1.0 then return ay else return ax+(ay-ax)*ah end end,LerpUnclamped=function(ax,ay,ah)if ah==0.0 then return ax elseif ah==1.0 then return ay else return ax+(ay-ax)*ah end end,PingPong=function(ah,az)if az==0 then return 0 end;local aA=math.floor(ah/az)local aB=ah-aA*az;if aA<0 then if(aA+1)%2==0 then return az-aB else return aB end else if aA%2==0 then return aB else return az-aB end end end,VectorApproximatelyEquals=function(aC,aD)return(aC-aD).sqrMagnitude<1E-10 end,QuaternionApproximatelyEquals=function(aC,aD)local aE=Quaternion.Dot(aC,aD)return aE<1.0+1E-06 and aE>1.0-1E-06 end,QuaternionToAngleAxis=function(aF)local aA=aF.normalized;local aG=math.acos(aA.w)local aH=math.sin(aG)local aI=math.deg(aG*2.0)local aJ;if math.abs(aH)<=Quaternion.kEpsilon then aJ=Vector3.right else local aK=1.0/aH;aJ=Vector3.__new(aA.x*aK,aA.y*aK,aA.z*aK)end;return aI,aJ end,ApplyQuaternionToVector3=function(aF,aL)local aM=aF.w*aL.x+aF.y*aL.z-aF.z*aL.y;local aN=aF.w*aL.y-aF.x*aL.z+aF.z*aL.x;local aO=aF.w*aL.z+aF.x*aL.y-aF.y*aL.x;local aP=-aF.x*aL.x-aF.y*aL.y-aF.z*aL.z;return Vector3.__new(aP*-aF.x+aM*aF.w+aN*-aF.z-aO*-aF.y,aP*-aF.y-aM*-aF.z+aN*aF.w+aO*-aF.x,aP*-aF.z+aM*-aF.y-aN*-aF.x+aO*aF.w)end,RotateAround=function(aQ,aR,aS,aT)return aS+a.ApplyQuaternionToVector3(aT,aQ-aS),aT*aR end,Random32=function()return bit32.band(math.random(-2147483648,2147483646),0xFFFFFFFF)end,RandomUUID=function()return a.UUIDFromNumbers(a.Random32(),bit32.bor(0x4000,bit32.band(a.Random32(),0xFFFF0FFF)),bit32.bor(0x80000000,bit32.band(a.Random32(),0x3FFFFFFF)),a.Random32())end,UUIDString=function(aU)return o.__tostring(aU)end,UUIDFromNumbers=function(...)local aV=...local ah=type(aV)local aW,aX,aY,aZ;if ah=='table'then aW=aV[1]aX=aV[2]aY=aV[3]aZ=aV[4]else aW,aX,aY,aZ=...end;local aU={bit32.band(aW or 0,0xFFFFFFFF),bit32.band(aX or 0,0xFFFFFFFF),bit32.band(aY or 0,0xFFFFFFFF),bit32.band(aZ or 0,0xFFFFFFFF)}setmetatable(aU,o)return aU end,UUIDFromString=function(O)local R=string.len(O)if R~=32 and R~=36 then return nil end;local a_='[0-9a-f-A-F]+'local b0='^('..a_..')$'local b1='^-('..a_..')$'local b2,b3,b4,b5;if R==32 then local aU=a.UUIDFromNumbers(0,0,0,0)local b6=1;for m,b7 in ipairs({8,16,24,32})do b2,b3,b4=string.find(string.sub(O,b6,b7),b0)if not b2 then return nil end;aU[m]=tonumber(b4,16)b6=b7+1 end;return aU else b2,b3,b4=string.find(string.sub(O,1,8),b0)if not b2 then return nil end;local aW=tonumber(b4,16)b2,b3,b4=string.find(string.sub(O,9,13),b1)if not b2 then return nil end;b2,b3,b5=string.find(string.sub(O,14,18),b1)if not b2 then return nil end;local aX=tonumber(b4 ..b5,16)b2,b3,b4=string.find(string.sub(O,19,23),b1)if not b2 then return nil end;b2,b3,b5=string.find(string.sub(O,24,28),b1)if not b2 then return nil end;local aY=tonumber(b4 ..b5,16)b2,b3,b4=string.find(string.sub(O,29,36),b0)if not b2 then return nil end;local aZ=tonumber(b4,16)return a.UUIDFromNumbers(aW,aX,aY,aZ)end end,ParseUUID=function(O)return a.UUIDFromString(O)end,
CreateCircularQueue=function(b8)if type(b8)~='number'or b8<1 then error('Invalid argument: capacity = '..tostring(b8),2)end;local self;local b9=math.floor(b8)local T={}local ba=0;local bb=0;local bc=0;self={Size=function()return bc end,Clear=function()ba=0;bb=0;bc=0 end,IsEmpty=function()return bc==0 end,Offer=function(bd)T[ba+1]=bd;ba=(ba+1)%b9;if bc<b9 then bc=bc+1 else bb=(bb+1)%b9 end;return true end,OfferFirst=function(bd)bb=(b9+bb-1)%b9;T[bb+1]=bd;if bc<b9 then bc=bc+1 else ba=(b9+ba-1)%b9 end;return true end,Poll=function()if bc==0 then return nil else local bd=T[bb+1]bb=(bb+1)%b9;bc=bc-1;return bd end end,PollLast=function()if bc==0 then return nil else ba=(b9+ba-1)%b9;local bd=T[ba+1]bc=bc-1;return bd end end,Peek=function()if bc==0 then return nil else return T[bb+1]end end,PeekLast=function()if bc==0 then return nil else return T[(b9+ba-1)%b9+1]end end,Get=function(be)if be<1 or be>bc then a.LogError('CreateCircularQueue.Get: index is outside the range: '..be)return nil end;return T[(bb+be-1)%b9+1]end,IsFull=function()return bc>=b9 end,MaxSize=function()return b9 end}return self end,ColorFromARGB32=function(bf)local bg=type(bf)=='number'and bf or 0xFF000000;return Color.__new(bit32.band(bit32.rshift(bg,16),0xFF)/0xFF,bit32.band(bit32.rshift(bg,8),0xFF)/0xFF,bit32.band(bg,0xFF)/0xFF,bit32.band(bit32.rshift(bg,24),0xFF)/0xFF)end,ColorToARGB32=function(bh)return bit32.bor(bit32.lshift(bit32.band(a.Round(0xFF*bh.a),0xFF),24),bit32.lshift(bit32.band(a.Round(0xFF*bh.r),0xFF),16),bit32.lshift(bit32.band(a.Round(0xFF*bh.g),0xFF),8),bit32.band(a.Round(0xFF*bh.b),0xFF))end,ColorFromIndex=function(bi,bj,bk,bl,bm)local bn=math.max(math.floor(bj or a.ColorHueSamples),1)local bo=bm and bn or bn-1;local bp=math.max(math.floor(bk or a.ColorSaturationSamples),1)local bq=math.max(math.floor(bl or a.ColorBrightnessSamples),1)local be=a.Clamp(math.floor(bi or 0),0,bn*bp*bq-1)local br=be%bn;local bs=math.floor(be/bn)local aK=bs%bp;local bt=math.floor(bs/bp)if bm or br~=bo then local B=br/bo;local bu=(bp-aK)/bp;local D=(bq-bt)/bq;return Color.HSVToRGB(B,bu,D)else local D=(bq-bt)/bq*aK/(bp-1)return Color.HSVToRGB(0.0,0.0,D)end end,DetectClicks=function(bv,bw,bx)local by=bv or 0;local bz=bx or TimeSpan.FromMilliseconds(500)local bA=vci.me.Time;local bB=bw and bA>bw+bz and 1 or by+1;return bB,bA end,GetEffekseerEmitterMap=function(a3)local bC=vci.assets.GetEffekseerEmitters(a3)if not bC then return nil end;local bD={}for m,bE in pairs(bC)do bD[bE.EffectName]=bE end;return bD end,GetSubItemTransform=function(bF)local bG=bF.GetPosition()local aT=bF.GetRotation()local bH=bF.GetLocalScale()return{positionX=bG.x,positionY=bG.y,positionZ=bG.z,rotationX=aT.x,rotationY=aT.y,rotationZ=aT.z,rotationW=aT.w,scaleX=bH.x,scaleY=bH.y,scaleZ=bH.z}end,RestoreCytanbTransform=function(bI)local bJ=bI.positionX and bI.positionY and bI.positionZ and Vector3.__new(bI.positionX,bI.positionY,bI.positionZ)or nil;local bK=bI.rotationX and bI.rotationY and bI.rotationZ and bI.rotationW and Quaternion.__new(bI.rotationX,bI.rotationY,bI.rotationZ,bI.rotationW)or nil;local bH=bI.scaleX and bI.scaleY and bI.scaleZ and Vector3.__new(bI.scaleX,bI.scaleY,bI.scaleZ)or nil;return bJ,bK,bH end,Vector3ToTable=function(p)return{[a.TypeParameterName]=a.Vector3TypeName,x=p.x,y=p.y,z=p.z}end,Vector3FromTable=function(F)local ay,L=E(F,a.Vector3TypeName)return ay and Vector3.__new(F.x,F.y,F.z)or nil,L end,QuaternionToTable=function(p)return{[a.TypeParameterName]=a.QuaternionTypeName,x=p.x,y=p.y,z=p.z,w=p.w}end,QuaternionFromTable=function(F)local ay,L=E(F,a.QuaternionTypeName)return ay and Quaternion.__new(F.x,F.y,F.z,F.w)or nil,L end,TableToSerializable=function(bL,aa)if type(bL)~='table'then return bL end;if not aa then aa={}end;if aa[bL]then error('circular reference')end;aa[bL]=true;local bM={}for M,D in pairs(bL)do local bN=type(M)local bO;if bN=='string'then bO=N(M)elseif bN=='number'then bO=tostring(M)..a.ArrayNumberTag else bO=M end;local bP=type(D)if bP=='string'then bM[bO]=N(D)elseif bP=='number'and D<0 then bM[tostring(bO)..a.NegativeNumberTag]=tostring(D)else bM[bO]=a.TableToSerializable(D,aa)end end;aa[bL]=nil;return bM end,TableFromSerializable=function(bM)if type(bM)~='table'then return bM end;local bL={}for M,D in pairs(bM)do local bO;local bQ=false;if type(M)=='string'then local bR=false;bO=P(M,function(bS)if bS==a.NegativeNumberTag then bQ=true elseif bS==a.ArrayNumberTag then bR=true end;return nil end)if bR then bO=tonumber(bO)or bO end else bO=M;bQ=false end;if bQ and type(D)=='string'then bL[bO]=tonumber(D)elseif type(D)=='string'then bL[bO]=P(D,function(bS)return e[bS]end)else bL[bO]=a.TableFromSerializable(D)end end;return bL end,TableToSerialiable=function(bL,aa)return a.TableToSerializable(bL,aa)end,TableFromSerialiable=function(bM)return a.TableFromSerializable(bM)end,EmitMessage=function(a3,bT)local table=bT and a.TableToSerializable(bT)or{}table[a.InstanceIDParameterName]=a.InstanceID()vci.message.Emit(a3,json.serialize(table))end,OnMessage=function(a3,bU)local bV=function(bW,bX,bY)local bZ=nil;if bW.type~='comment'and type(bY)=='string'then local b_,bM=pcall(json.parse,bY)if b_ and type(bM)=='table'then bZ=a.TableFromSerializable(bM)end end;local bT=bZ and bZ or{[a.MessageValueParameterName]=bY}bU(bW,bX,bT)end;vci.message.On(a3,bV)return{Off=function()if bV then bV=nil end end}end,OnInstanceMessage=function(a3,bU)local bV=function(bW,bX,bT)local c0=a.InstanceID()if c0~=''and c0==bT[a.InstanceIDParameterName]then bU(bW,bX,bT)end end;return a.OnMessage(a3,bV)end}a.SetConstEach(a,{LogLevelOff=0,LogLevelFatal=100,LogLevelError=200,LogLevelWarn=300,LogLevelInfo=400,LogLevelDebug=500,LogLevelTrace=600,LogLevelAll=0x7FFFFFFF,ColorHueSamples=10,ColorSaturationSamples=4,ColorBrightnessSamples=5,EscapeSequenceTag='#__CYTANB',SolidusTag='#__CYTANB_SOLIDUS',NegativeNumberTag='#__CYTANB_NEGATIVE_NUMBER',ArrayNumberTag='#__CYTANB_ARRAY_NUMBER',InstanceIDParameterName='__CYTANB_INSTANCE_ID',MessageValueParameterName='__CYTANB_MESSAGE_VALUE',TypeParameterName='__CYTANB_TYPE',Vector3TypeName='Vector3',QuaternionTypeName='Quaternion'})a.SetConstEach(a,{ColorMapSize=a.ColorHueSamples*a.ColorSaturationSamples*a.ColorBrightnessSamples,FatalLogLevel=a.LogLevelFatal,ErrorLogLevel=a.LogLevelError,WarnLogLevel=a.LogLevelWarn,InfoLogLevel=a.LogLevelInfo,DebugLogLevel=a.LogLevelDebug,TraceLogLevel=a.LogLevelTrace})c={[a.Vector3TypeName]={nameMap=a.ListToMap({'x','y','z'}),length=3},[a.QuaternionTypeName]={nameMap=a.ListToMap({'x','y','z','w'}),length=4}}d={{tag=a.NegativeNumberTag,pattern='^'..a.NegativeNumberTag,replacement=''},{tag=a.ArrayNumberTag,pattern='^'..a.ArrayNumberTag,replacement=''},{tag=a.SolidusTag,pattern='^'..a.SolidusTag,replacement='/'},{tag=a.EscapeSequenceTag,pattern='^'..a.EscapeSequenceTag..a.EscapeSequenceTag,replacement=a.EscapeSequenceTag}}e=a.ListToMap({a.NegativeNumberTag,a.ArrayNumberTag})f=a.LogLevelInfo;h={[a.LogLevelFatal]='FATAL',[a.LogLevelError]='ERROR',[a.LogLevelWarn]='WARN',[a.LogLevelInfo]='INFO',[a.LogLevelDebug]='DEBUG',[a.LogLevelTrace]='TRACE'}package.loaded['cytanb']=a;i=vci.state.Get(b)or''if i==''and vci.assets.IsMine then i=tostring(a.RandomUUID())vci.state.Set(b,i)end;return a end)()
