-- cytanb | Copyright (c) 2019 oO (https://github.com/oocytanb) | MIT Licensed
---@type cytanb @See `cytanb_annotations.lua`
local cytanb=(function()math.randomseed(os.time()-os.clock()*10000)local b='__CYTANB_INSTANCE_ID'local c=400;local d;local a;a={InstanceID=function()if d==''then d=vci.state.Get(b)or''end;return d end,SetConst=function(e,f,g)if type(e)~='table'then error('Cannot set const to non-table target')end;local h=getmetatable(e)local i=h or{}local j=type(i.__index)=='table'if e[f]~=nil and(not j or i.__index[f]==nil)then error('Non-const field "'..f..'" already exists')end;if not j then i.__index={}end;local k=i.__index;k[f]=g;if not j or type(i.__newindex)~='function'then i.__newindex=function(table,l,m)if table==e and k[l]~=nil then error('Cannot assign to read only field "'..l..'"')end;rawset(table,l,m)end end;if not h then setmetatable(e,i)end;return e end,Extend=function(e,n,o,p,q)if e==n or type(e)~='table'or type(n)~='table'then return e end;if o then if not q then q={}end;if q[n]then error('circular reference')end;q[n]=true end;for r,m in pairs(n)do if o and type(m)=='table'then local s=e[r]e[r]=a.Extend(type(s)=='table'and s or{},m,o,p,q)else e[r]=m end end;if not p then local t=getmetatable(n)if type(t)=='table'then if o then local u=getmetatable(e)setmetatable(e,a.Extend(type(u)=='table'and u or{},t,true))else setmetatable(e,t)end end end;if o then q[n]=nil end;return e end,Vars=function(m,v,w,q)local x;if v then x=v~='__NOLF'else v='  'x=true end;if not w then w=''end;if not q then q={}end;local y=type(m)if y=='table'then q[m]=q[m]and q[m]+1 or 1;local z=x and w..v or''local A='('..tostring(m)..') {'local B=true;for l,C in pairs(m)do if B then B=false else A=A..(x and','or', ')end;if x then A=A..'\n'..z end;if type(C)=='table'and q[C]and q[C]>0 then A=A..l..' = ('..tostring(C)..')'else A=A..l..' = '..a.Vars(C,v,z,q)end end;if not B and x then A=A..'\n'..w end;A=A..'}'q[m]=q[m]-1;if q[m]<=0 then q[m]=nil end;return A elseif y=='function'or y=='thread'or y=='userdata'then return'('..y..')'elseif y=='string'then return'('..y..') '..string.format('%q',m)else return'('..y..') '..tostring(m)end end,GetLogLevel=function()return c end,SetLogLevel=function(D)c=D end,Log=function(D,...)if D<=c then local E=table.pack(...)if E.n==1 then local m=E[1]if m~=nil then print(type(m)=='table'and a.Vars(m)or tostring(m))else print('')end else local A=''for F=1,E.n do local m=E[F]if m~=nil then A=A..(type(m)=='table'and a.Vars(m)or tostring(m))end end;print(A)end end end,LogFatal=function(...)a.Log(a.LogLevelFatal,...)end,LogError=function(...)a.Log(a.LogLevelError,...)end,LogWarn=function(...)a.Log(a.LogLevelWarn,...)end,LogInfo=function(...)a.Log(a.LogLevelInfo,...)end,LogDebug=function(...)a.Log(a.LogLevelDebug,...)end,LogTrace=function(...)a.Log(a.LogLevelTrace,...)end,FatalLog=function(...)a.LogFatal(...)end,ErrorLog=function(...)a.LogError(...)end,WarnLog=function(...)a.LogWarn(...)end,InfoLog=function(...)a.LogInfo(...)end,DebugLog=function(...)a.LogDebug(...)end,TraceLog=function(...)a.LogTrace(...)end,ListToMap=function(G,H)local table={}local I=H==nil;for r,m in pairs(G)do table[m]=I and m or H end;return table end,Round=function(J,K)if K then local L=10^K;return math.floor(J*L+0.5)/L else return math.floor(J+0.5)end end,Lerp=function(M,N,y)if y<=0.0 then return M elseif y>=1.0 then return N else return M+(N-M)*y end end,LerpUnclamped=function(M,N,y)return M+(N-M)*y end,Random32=function()return bit32.band(math.random(-2147483648,2147483646),0xFFFFFFFF)end,RandomUUID=function()return{a.Random32(),bit32.bor(0x4000,bit32.band(a.Random32(),0xFFFF0FFF)),bit32.bor(0x80000000,bit32.band(a.Random32(),0x3FFFFFFF)),a.Random32()}end,UUIDString=function(O)local P=O[2]or 0;local Q=O[3]or 0;return string.format('%08x-%04x-%04x-%04x-%04x%08x',bit32.band(O[1]or 0,0xFFFFFFFF),bit32.band(bit32.rshift(P,16),0xFFFF),bit32.band(P,0xFFFF),bit32.band(bit32.rshift(Q,16),0xFFFF),bit32.band(Q,0xFFFF),bit32.band(O[4]or 0,0xFFFFFFFF))end,ParseUUID=function(A)local R=string.len(A)if R~=32 and R~=36 then return nil end;local S='[0-9a-f-A-F]+'local T='^('..S..')$'local U='^-('..S..')$'local O={}local V,W,X,Y;if R==32 then local Z=1;for F,_ in ipairs({8,16,24,32})do V,W,X=string.find(string.sub(A,Z,_),T)if not V then return nil end;O[F]=tonumber(X,16)Z=_+1 end else V,W,X=string.find(string.sub(A,1,8),T)if not V then return nil end;O[1]=tonumber(X,16)V,W,X=string.find(string.sub(A,9,13),U)if not V then return nil end;V,W,Y=string.find(string.sub(A,14,18),U)if not V then return nil end;O[2]=tonumber(X..Y,16)V,W,X=string.find(string.sub(A,19,23),U)if not V then return nil end;V,W,Y=string.find(string.sub(A,24,28),U)if not V then return nil end;O[3]=tonumber(X..Y,16)V,W,X=string.find(string.sub(A,29,36),T)if not V then return nil end;O[4]=tonumber(X,16)end;return O end,ColorFromARGB32=function(a0)local a1=type(a0)=='number'and a0 or 0xFF000000;return Color.__new(bit32.band(bit32.rshift(a1,16),0xFF)/0xFF,bit32.band(bit32.rshift(a1,8),0xFF)/0xFF,bit32.band(a1,0xFF)/0xFF,bit32.band(bit32.rshift(a1,24),0xFF)/0xFF)end,ColorToARGB32=function(a2)return bit32.bor(bit32.lshift(math.floor(255*a2.a+0.5),24),bit32.lshift(math.floor(255*a2.r+0.5),16),bit32.lshift(math.floor(255*a2.g+0.5),8),math.floor(255*a2.b+0.5))end,ColorFromIndex=function(a3,a4,a5,a6,a7)local a8=math.max(math.floor(a4 or a.ColorHueSamples),1)local a9=a7 and a8 or a8-1;local aa=math.max(math.floor(a5 or a.ColorSaturationSamples),1)local ab=math.max(math.floor(a6 or a.ColorBrightnessSamples),1)local ac=math.max(math.min(math.floor(a3 or 0),a8*aa*ab-1),0)local ad=ac%a8;local ae=math.floor(ac/a8)local af=ae%aa;local ag=math.floor(ae/aa)if a7 or ad~=a9 then local ah=ad/a9;local ai=(aa-af)/aa;local m=(ab-ag)/ab;return Color.HSVToRGB(ah,ai,m)else local m=(ab-ag)/ab*af/(aa-1)return Color.HSVToRGB(0.0,0.0,m)end end,GetSubItemTransform=function(aj)local ak=aj.GetPosition()local al=aj.GetRotation()local am=aj.GetLocalScale()return{positionX=ak.x,positionY=ak.y,positionZ=ak.z,rotationX=al.x,rotationY=al.y,rotationZ=al.z,rotationW=al.w,scaleX=am.x,scaleY=am.y,scaleZ=am.z}end,TableToSerializable=function(an,q)if type(an)~='table'then return an end;if not q then q={}end;if q[an]then error('circular reference')end;q[an]=true;local ao={}for r,m in pairs(an)do local ap=type(r)=='number'and tostring(r)..a.ArrayNumberTag or r;if type(m)=='number'and m<0 then ao[tostring(ap)..a.NegativeNumberTag]=tostring(m)else ao[ap]=a.TableToSerializable(m,q)end end;q[an]=nil;return ao end,TableFromSerializable=function(ao)if type(ao)~='table'then return ao end;local an={}for r,m in pairs(ao)do local ap;local aq;if type(r)=='string'then if string.endsWith(r,a.NegativeNumberTag)then ap=string.sub(r,1,-1-#a.NegativeNumberTag)aq=true else ap=r;aq=false end;if string.endsWith(ap,a.ArrayNumberTag)then local ar=string.sub(ap,1,-1-#a.ArrayNumberTag)ap=tonumber(ar)or ar end else ap=r;aq=false end;if aq then an[ap]=type(m)=='string'and tonumber(m)or a.TableFromSerializable(m)else an[ap]=a.TableFromSerializable(m)end end;return an end,TableToSerialiable=function(an,q)return a.TableToSerializable(an,q)end,TableFromSerialiable=function(ao)return a.TableFromSerializable(ao)end,EmitMessage=function(f,as)local table=as and a.TableToSerializable(as)or{}table[a.InstanceIDParameterName]=a.InstanceID()vci.message.Emit(f,json.serialize(table))end,OnMessage=function(f,at)local au=function(av,aw,ax)local ay=nil;if av.type~='comment'and type(ax)=='string'then local az,ao=pcall(json.parse,ax)if az and type(ao)=='table'then ay=a.TableFromSerializable(ao)end end;local as=ay and ay or{[a.MessageValueParameterName]=ax}at(av,aw,as)end;vci.message.On(f,au)return{Off=function()if au then au=nil end end}end}a:SetConst('LogLevelFatal',100):SetConst('LogLevelError',200):SetConst('LogLevelWarn',300):SetConst('LogLevelInfo',400):SetConst('LogLevelDebug',500):SetConst('LogLevelTrace',600):SetConst('FatalLogLevel',a.LogLevelFatal):SetConst('ErrorLogLevel',a.LogLevelError):SetConst('WarnLogLevel',a.LogLevelWarn):SetConst('InfoLogLevel',a.LogLevelInfo):SetConst('DebugLogLevel',a.LogLevelDebug):SetConst('TraceLogLevel',a.LogLevelTrace):SetConst('ColorHueSamples',10):SetConst('ColorSaturationSamples',4):SetConst('ColorBrightnessSamples',5):SetConst('ColorMapSize',a.ColorHueSamples*a.ColorSaturationSamples*a.ColorBrightnessSamples):SetConst('NegativeNumberTag','#__CYTANB_NEGATIVE_NUMBER'):SetConst('ArrayNumberTag','#__CYTANB_ARRAY_NUMBER'):SetConst('InstanceIDParameterName','__CYTANB_INSTANCE_ID'):SetConst('MessageValueParameterName','__CYTANB_MESSAGE_VALUE')package.loaded['cytanb']=a;if vci.assets.IsMine then d=a.UUIDString(a.RandomUUID())vci.state.Set(b,d)else d=''end;return a end)()
